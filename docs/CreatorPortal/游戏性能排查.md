# 游戏性能排查

::: tip 阅读本文大概需要15分钟。

本文将帮助您快速查看游戏客户端性能数据、服务器房间数据及房间实时日志。

::: 

## 客户端性能

本部分提供了**平均帧率、平均ping值、平均内存、DrawCall等**客户端性能指标，表现玩家在玩游戏时客户端的性能情况，**其中只有平均帧率是越高越好，其他指标都是越低越好****，点击【游戏数据】-【****[性能数据](https://portal.ark.online/#/admin/performance-data)****】查看。**

![img](https://arkimg.ark.online/1684028194556-79.webp)

- **平均帧率**：每秒能够渲染的帧数；
- **平均ping**：游戏中延迟的程度；
- **平均内存**：游戏运行内存占用；
- **平均DrawCall**：CPU调用图形渲染接口的次数，该数值越高用于渲染的开销越高；
- **游戏线程平均耗时**：每一帧用于游戏内Tick事件，角色动画更新，物理计算，UI更新等的总耗时；
- **渲染线程平均耗时**：每一帧用于进行场景的剔除，准备渲染数据和渲染命令等的总耗时；

### **客户端指标怎么看**

这部分的指标是小时级更新，根据查询时间的不同返回不同维度的数据，当跨天查询时，返回天级数据，同一天查询时，则展示小时级数据。

![img](https://arkimg.ark.online/1684028194556-80.webp)

从箱型图中，可以看到该时段上报数据的中位数、上四分位数、下四分位数、最大值、最小值和异常值。

> 中位数用来表示数据的整体趋势：中位数高，表示平均水平较高，中位数低，表示平均水平较低；
>
> 上下四分位数的差可以表现数据的离散情况：箱子短，表明数据集中，箱子长，表明这组数据分散；

![img](https://arkimg.ark.online/1684028194556-81.webp)

例如图中，在当日22时，游戏的运行内存中位数是506.07，上四和下四分位数分别是649.88和429.40。

### **客户端指标怎么优化**

帧率过低、平均Drawcall过高、平均内存过高、游戏线程平均耗时过高、渲染线程平均耗时过高都可以参照以下内容统一优化解决思路。

**Tips1：减少场景里的模型数量**

- 尽可能减少场景里面的物体数量，能用一个物体的就不要用多个；
- 比如地板，可以用平面+贴图，不要一个一个方块地去“贴地砖”；
- 又比如房屋，能用现成的房屋就不要从地板、墙面、楼梯、天花板一个一个搭；

![img](https://arkimg.ark.online/1684028194556-82.gif)

**Tips2：提高模型的复用率**

- 提高场景里模型物件的复用率，如用于场景装饰的箱子等，可以在不同地方多次出现；

![img](https://arkimg.ark.online/1684028194556-83.webp)

**Tips3：少用半透、植被相关资源**

- 少用这类带标识的资源，这类资源带有mask材质，会导致游戏产生性能风险，能不用就不用；

![img](https://arkimg.ark.online/1684028194556-84.webp)

**Tips4：多用低面数的模型代替高精建模**

- 面数过多，手机负担过大，场景建模建议多用lowpoly相关的；
- 能用基础模型就不用lowpoly，能用lowpoly就不用写实风格；

![img](https://arkimg.ark.online/1684028194556-85.webp)

**Tips5：适当减少场景里的npc人型对象**

![img](https://arkimg.ark.online/1684028194556-86.webp)

**Tips6：代码层面要简化**

代码里尽量少写死循环，少用性能消耗高的API ，如RPC、Replicated相关的、换装同步、高频循环等；

## 房间管理

::: tip 功能概述

房间数据部分提供实时房间&玩家数据，可以查看分时/分日的数据变动趋势，以及每个房间的实时日志。

::: 

![img](https://arkimg.ark.online/1684028194556-87.webp)

当您的游戏上线后，实时玩家数会展示在【[我的游戏](https://portal.ark.online/#/admin/game-list)】，点击数据可快速进入当前游戏房间列表。

### 房间实时看板

![img](https://arkimg.ark.online/1684028194556-88.webp)

【游戏服务】-【[房间管理](https://portal.ark.online/#/admin/room-data)】可以查看所有游戏整体房间数据情况。

![img](https://arkimg.ark.online/1684028194556-89.gif)

折线图数据提供分时的实时数据，可以明确看出一天中数据的变动情况，跨天查询则会展示以天为维度的数据，可以进行游戏之间的对比。

### 房间行为细查

![img](https://arkimg.ark.online/1684028194556-90.webp)

点击【游戏服务】-【[房间管理](https://portal.ark.online/#/admin/room-data)】-【查看】可以查看具体游戏的房间情况。

![img](https://arkimg.ark.online/1684028194556-91.gif)

通过房间&玩家行为细查，可以每个房间的存活路径，也能看到每个玩家的行为路径。

### 服务端实时日志

![img](https://arkimg.ark.online/1684028194556-92.webp)

测试游戏时可以通过实时日志打印log信息，进入游戏找到当前房间号，在房间列表查询到运行中的房间，点击实时日志，即可打印&下载实时日志。

![img](https://arkimg.ark.online/1684028194556-93.webp)

- **MWTS**：脚本里面游戏创作者打印的日志；
- **MWTSLIB**：编辑器封装好的的API内部打印的日志；